<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mes ProgrÃ¨s - SESSAD Petit Prince</title>
    
    <link rel="icon" type="image/png" href="favicon.png">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
</head>
<body>
    <nav class="main-nav">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <img src="logo-petit-prince.webp" alt="Logo Petit Prince">
                <h1>SESSAD Petit Prince</h1>
            </a>
            
            <button class="menu-toggle" aria-label="Menu">
                <span></span>
                <span></span>
                <span></span>
            </button>
            
                                    <ul class="nav-menu">
                <li><a href="index.html">ğŸ  Accueil</a></li>
                <li><a href="assistant-tdah.html">ğŸ§  TDAH</a></li>
                <li><a href="assistant-tsa.html">ğŸ§© TSA</a></li>
                <li><a href="assistant-dys.html">ğŸ“š Dys</a></li>
                <li><a href="outils.html">ğŸ› ï¸ Outils</a></li>
                <li><a href="ressources.html">ğŸ“– Ressources</a></li>
                <li class="nav-dropdown">
                    <button class="nav-dropdown-toggle">
                        ğŸ‘¤ Mon Espace â–¼
                    </button>
                    <div class="nav-dropdown-menu">
                        <a href="mon-profil.html">ğŸ‘¤ Mon Profil</a>
                        <a href="mes-recompenses.html">ğŸ† Mes RÃ©compenses</a>
                        <a href="mon-journal.html">ğŸ“– Mon Journal</a>
                        <a href="mes-progres.html">ğŸ“ˆ Mes ProgrÃ¨s</a>
                        <a href="mini-jeux.html">ğŸ® Mini-Jeux</a>
                    </div>
                </li>
                <li><a href="contact.html">ğŸ“§ Contact</a></li>
            </ul>
            
            <div class="nav-accessibility">
                <button id="textSizeBtn" class="accessibility-btn">A+</button>
                <button id="contrastBtn" class="accessibility-btn">â—</button>
                <button id="dyslexicBtn" class="accessibility-btn">Dys</button>
            </div>
        </div>
    </nav>

    <div class="container">
        <nav class="breadcrumb">
            <ul class="breadcrumb-list">
                <li><a href="index.html">Accueil</a></li>
                <li><span class="breadcrumb-separator">â€º</span></li>
                <li>Mes ProgrÃ¨s</li>
            </ul>
        </nav>

        <div class="card" style="text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; margin-bottom: 40px;">
            <h1 style="font-size: 3rem; color: white; margin-bottom: 20px;">ğŸ“ˆ Mes ProgrÃ¨s</h1>
            <p style="font-size: 1.3rem; opacity: 0.95;">Visualise ton Ã©volution et cÃ©lÃ¨bre tes rÃ©ussites !</p>
        </div>

        <!-- Vue d'ensemble -->
        <div class="card">
            <h2 class="card-title">ğŸ“Š Vue d'Ensemble</h2>
            
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                <div style="background: #E8F5E9; padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem;">âœ…</div>
                    <div style="font-size: 2.5rem; font-weight: 700; color: var(--success); margin: 10px 0;" id="totalTasks">0</div>
                    <div style="color: #666;">TÃ¢ches complÃ©tÃ©es</div>
                </div>

                <div style="background: #FFF3E0; padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem;">ğŸ“‹</div>
                    <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary); margin: 10px 0;" id="totalSequentials">0</div>
                    <div style="color: #666;">SÃ©quentiels crÃ©Ã©s</div>
                </div>

                <div style="background: #E3F2FD; padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem;">ğŸ“–</div>
                    <div style="font-size: 2.5rem; font-weight: 700; color: var(--info); margin: 10px 0;" id="totalJournals">0</div>
                    <div style="color: #666;">EntrÃ©es journal</div>
                </div>

                <div style="background: #F3E5F5; padding: 25px; border-radius: 15px; text-align: center;">
                    <div style="font-size: 3rem;">â­</div>
                    <div style="font-size: 2.5rem; font-weight: 700; color: var(--primary); margin: 10px 0;" id="totalPoints">0</div>
                    <div style="color: #666;">Points gagnÃ©s</div>
                </div>
            </div>
        </div>

        <!-- Graphiques -->
        <div class="card">
            <h2 class="card-title">ğŸ“Š ActivitÃ© des 7 Derniers Jours</h2>
            <canvas id="activityChart" style="max-height: 300px; margin-top: 30px;"></canvas>
        </div>

        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 30px;">
            <div class="card">
                <h2 class="card-title">ğŸ¯ TÃ¢ches par PrioritÃ©</h2>
                <canvas id="priorityChart" style="max-height: 250px; margin-top: 30px;"></canvas>
            </div>

            <div class="card">
                <h2 class="card-title">ğŸ˜Š RÃ©partition Ã‰motions</h2>
                <canvas id="emotionsChart" style="max-height: 250px; margin-top: 30px;"></canvas>
            </div>
        </div>

        <!-- Historique -->
        <div class="card">
            <h2 class="card-title">ğŸ“… Mon Historique</h2>
            
            <div style="margin-top: 30px;">
                <h3 style="color: var(--primary); margin-bottom: 20px;">ğŸ‰ DerniÃ¨res RÃ©ussites</h3>
                <div id="recentAchievements"></div>
            </div>

            <div style="margin-top: 30px;">
                <h3 style="color: var(--primary); margin-bottom: 20px;">ğŸ† Badges RÃ©cents</h3>
                <div id="recentBadges"></div>
            </div>
        </div>

        <!-- Exporter -->
        <div class="card" style="background: #E8F5E9; border: 2px solid var(--success);">
            <h3 style="color: var(--success); margin-bottom: 20px;">ğŸ“¥ Exporter Mes DonnÃ©es</h3>
            <p style="margin-bottom: 20px; line-height: 1.8;">TÃ©lÃ©charge un rapport complet de tes progrÃ¨s en PDF ou Excel.</p>
            <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                <button onclick="exportPDF()" class="btn btn-success">ğŸ“„ Exporter en PDF</button>
                <button onclick="exportCSV()" class="btn btn-info">ğŸ“Š Exporter en CSV</button>
            </div>
        </div>
    </div>

    <footer>
        <div class="footer-content">
            <div class="footer-section">
                <h3>Navigation</h3>
                <ul>
                    <li><a href="index.html">Accueil</a></li>
                    <li><a href="mon-profil.html">Mon Profil</a></li>
                    <li><a href="mes-recompenses.html">Mes RÃ©compenses</a></li>
                    <li><a href="mon-journal.html">Mon Journal</a></li>
                </ul>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2024 SESSAD Petit Prince - Tous droits rÃ©servÃ©s</p>
        </div>
    </footer>

    <button class="back-to-top" aria-label="Retour en haut">â†‘</button>
    <script src="script.js"></script>
    <script>
        let profile = JSON.parse(localStorage.getItem('user_profile')) || { stats: {} };
        let tdahTasks = JSON.parse(localStorage.getItem('tdah_tasks')) || [];
        let dysTasks = JSON.parse(localStorage.getItem('dys_tasks')) || [];
        let journals = JSON.parse(localStorage.getItem('daily_journals')) || [];

        window.addEventListener('load', () => {
            updateStats();
            createActivityChart();
            createPriorityChart();
            createEmotionsChart();
            displayRecentAchievements();
        });

        function updateStats() {
            const completedTasks = [...tdahTasks, ...dysTasks].filter(t => t.completed);
            
            document.getElementById('totalTasks').textContent = completedTasks.length;
            document.getElementById('totalSequentials').textContent = profile.stats?.sequentialsCreated || 0;
            document.getElementById('totalJournals').textContent = journals.length;
            document.getElementById('totalPoints').textContent = profile.stats?.totalPoints || 0;
        }

        function createActivityChart() {
            const ctx = document.getElementById('activityChart');
            const last7Days = [];
            
            for (let i = 6; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                last7Days.push(date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' }));
            }

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: last7Days,
                    datasets: [{
                        label: 'TÃ¢ches',
                        data: [3, 5, 2, 4, 6, 3, 4],
                        backgroundColor: 'rgba(102, 126, 234, 0.7)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });
        }

        function createPriorityChart() {
            const ctx = document.getElementById('priorityChart');
            const allTasks = [...tdahTasks, ...dysTasks];
            
            const highPriority = allTasks.filter(t => t.priority === 'high').length;
            const mediumPriority = allTasks.filter(t => t.priority === 'medium').length;
            const lowPriority = allTasks.filter(t => t.priority === 'low').length;

            new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Haute', 'Moyenne', 'Basse'],
                    datasets: [{
                        data: [highPriority, mediumPriority, lowPriority],
                        backgroundColor: ['#FF6B6B', '#F4A460', '#4ECDC4']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });
        }

        function createEmotionsChart() {
            const ctx = document.getElementById('emotionsChart');
            
            const emotionCounts = {};
            journals.forEach(j => {
                const label = j.emotion.label;
                emotionCounts[label] = (emotionCounts[label] || 0) + 1;
            });

            new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: Object.keys(emotionCounts),
                    datasets: [{
                        data: Object.values(emotionCounts),
                        backgroundColor: ['#FFD700', '#87CEEB', '#FF6B6B', '#4ECDC4', '#9B59B6', '#F4A460']
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true
                }
            });
        }

        function displayRecentAchievements() {
            const container = document.getElementById('recentAchievements');
            const completedTasks = [...tdahTasks, ...dysTasks].filter(t => t.completed).slice(0, 5);
            
            if (completedTasks.length === 0) {
                container.innerHTML = '<p style="color: #999;">Aucune tÃ¢che complÃ©tÃ©e rÃ©cemment</p>';
                return;
            }

            container.innerHTML = completedTasks.map(task => `
                <div style="background: #E8F5E9; padding: 15px; border-radius: 10px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px;">
                    <div style="font-size: 2rem;">âœ…</div>
                    <div style="flex: 1;">${task.text}</div>
                </div>
            `).join('');
        }

        function exportPDF() {
            Utils.showToast('ğŸ“„ Export PDF en dÃ©veloppement', 'info');
        }

        function exportCSV() {
            const data = [
                ['Type', 'Description', 'Date', 'Statut'],
                ...tdahTasks.map(t => ['TÃ¢che', t.text, t.createdAt, t.completed ? 'TerminÃ©' : 'En cours']),
                ...journals.map(j => ['Journal', j.feelings.substring(0, 50), j.date, j.emotion.label])
            ];

            const csv = data.map(row => row.join(',')).join('\n');
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = `mes-progres-${new Date().toISOString().split('T')[0]}.csv`;
            a.click();
            
            Utils.showToast('âœ“ DonnÃ©es exportÃ©es !', 'success');
        }
    </script>
</body>
</html>
